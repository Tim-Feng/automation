flowchart TB
    subgraph "‚öôÔ∏è ‰æùË≥¥È†ÖÁÆ°ÁêÜ"
        DEP[dependency_manager.py] -->|ÁâàÊú¨Ê™¢Êü•| DEP1[Ê™¢Êü• yt-dlp ÁâàÊú¨]
        DEP1 -->|Ëá™ÂãïÊõ¥Êñ∞| DEP2[Êõ¥Êñ∞Ëá≥ÊúÄÊñ∞ÁâàÊú¨]
        DEP2 -->|ÁãÄÊÖãÂõûÂ†±| DEP3[Ë®òÈåÑÊõ¥Êñ∞ÁµêÊûú]
    end

    subgraph "1Ô∏è‚É£ ÂâçÁΩÆËôïÁêÜ"
        A[stage1-preparation.applescript] -->|Ëá™ÂãïÂåñËôïÁêÜ| A1[Âæû Google Sheets Êì∑ÂèñË≥áË®ä]
        A1 --> A11[‰ΩøÁî® Perplexity ÁîüÊàêÂÖßÂÆπ]
        A11 --> A2[‰∏ãËºâ YouTube ÂΩ±Áâá]
        A2 --> A21[‰ΩøÁî® Gemini ÂàÜÊûêÂΩ±Áâá]
        A21 --> A22[Âêà‰ΩµÂÖßÂÆπ‰∏¶‰ΩøÁî® OpenAI ÁîüÊàêÊ®ôÁ±§]
        A22 --> A3[Âª∫Á´ã WordPress ËçâÁ®ø]
        A3 --> A31[‰∏ãËºâ‰∏¶Â£ìÁ∏Æ YouTube Á∏ÆÂúñ]
        A31 --> A32[Ë®≠ÂÆöÁÇ∫ÊñáÁ´†ÁâπËâ≤ÂúñÁâá]
        A -->|‰ΩøÁî®| AA[google_sheets.py]
        A -->|‰ΩøÁî®| AB[wordpress_api.py]
        A -->|‰ΩøÁî®| AC[logger.py]
        A -->|‰ΩøÁî®| AD[tag_suggestion.py]
        A -->|‰ΩøÁî®| AE[perplexity_client.py]
        A -->|‰ΩøÁî®| AF[gemini_video_analyzer.py]
        A -->|‰ΩøÁî®| AG[pre_production_pipeline.py]
        A -->|‰ΩøÁî®| AH[batch_video_description.py]
        AC -->|Áµ±‰∏ÄÊó•Ë™åÁ≥ªÁµ±| ACL[log_bridge.py]
    end

    subgraph "2Ô∏è‚É£ ÂâçË£Ω‰ΩúÊ•≠"
        B[stage2-processing.applescript] -->|‰∫∫Â∑•Ê±∫Á≠ñ| B1[Ê±∫ÂÆöÂñÆÊîØ/Âêà‰ΩµÂΩ±Áâá]
        B1 -->|Ëá™ÂãïÂåñËôïÁêÜ| B2[Âª∫Á´ãÁõÆÈåÑÁµêÊßã]
        B2 --> B3[ÂΩ±ÁâáËΩâÊ™î 1920*1340]
        B3 --> B4[‰ΩøÁî® google_drive.py ‰∏äÂÇ≥Ëá≥ Google Drive]
        B4 -->|ÈáçË©¶Ê©üÂà∂| B5[Ë§áË£ΩËá≥Ê°åÈù¢Ë≥áÊñôÂ§æ]
        B5 --> B6[Âª∫Á´ã Trello ‰ªªÂãô]
        B -->|‰ΩøÁî®| BA[google_sheets.py]
        B -->|‰ΩøÁî®| BB[face_center_crop.py]
        B -->|‰ΩøÁî®| BC[logger.py]
        B -->|‰ΩøÁî®| BD[google_drive.py]
        BC -->|Áµ±‰∏ÄÊó•Ë™åÁ≥ªÁµ±| BCL[log_bridge.py]
    end

    subgraph "3Ô∏è‚É£ ÂæåË£ΩËôïÁêÜ"
        C[stage3-subtitling.applescript] -->|Â≠óÂπïËôïÁêÜ| C1[‰∏≠Ëã±ÊñáÂä†Á©∫ÁôΩ]
        C1 --> C2[ËΩâÊèõÁÇ∫ .ass Ê†ºÂºè]
        C2 --> C3[Âêà‰ΩµÂΩ±ÁâáÂ≠óÂπïÊãÜÂàÜ]
        C3 --> C4[ËΩâÊèõÁÇ∫ .vtt Ê†ºÂºè]
        C4 --> C5[‰∏äÂÇ≥Ëá≥ WordPress]
        C4 --> C6[Á°¨ÁáíÂ≠óÂπïËá≥ÂΩ±Áâá]
        C6 --> C7[‰∏äÂÇ≥Ëá≥ Google Drive]
        C7 -->|Ê®°Á≥äÊêúÂ∞ã| C8[Êõ¥Êñ∞ Google Docs]
        
        C -->|‰ΩøÁî®| CA[add_spaces.py]
        C -->|‰ΩøÁî®| CB[srt_to_ass_with_style.py]
        C -->|‰ΩøÁî®| CC[subtitle_splitter.py]
        C -->|‰ΩøÁî®| CD[upload_vtt.py]
        C -->|‰ΩøÁî®| CE[logger.py]
        C -->|‰ΩøÁî®| CF[google_sheets.py]
        CE -->|Áµ±‰∏ÄÊó•Ë™åÁ≥ªÁµ±| CEL[log_bridge.py]
    end

    subgraph "4Ô∏è‚É£ IG Ê®°ÊùøÂ•óÁî®"
        D[stage4-templating.applescript] -->|ËÆÄÂèñË≥áÊñô| D1[Âæû Google Docs ËÆÄÂèñÊñáÊ°à]
        D1 --> D2[‰ΩøÁî® FFmpeg Áî¢ÁîüÂΩ±ÁâáÂíåÂ∞ÅÈù¢]
        D2 --> D3[‰∏äÂÇ≥Ëá≥ Google Drive]
        D -->|‰ΩøÁî®| DA[ig_video_generator.py]
        D -->|‰ΩøÁî®| DB[ig_cover_generator.py]
        D -->|‰ΩøÁî®| DC[logger.py]
        D -->|‰ΩøÁî®| DD[google_drive.py]
        DC -->|Áµ±‰∏ÄÊó•Ë™åÁ≥ªÁµ±| DCL[log_bridge.py]
    end

    subgraph "üîß Ë™øË©¶Â∑•ÂÖ∑"
        T1[tools/check_sheet_row.py] -->|Ë®∫Êñ∑| T11[Ê™¢Êü• Google Sheets Ë≥áÊñô]
        T2[tools/test_tag_update.py] -->|Ê∏¨Ë©¶| T21[Ê∏¨Ë©¶Ê®ôÁ±§Êõ¥Êñ∞ÂäüËÉΩ]
        T3[tools/test_video_description_meta.py] -->|Ê∏¨Ë©¶| T31[Ê∏¨Ë©¶ÂΩ±ÁâáÊèèËø∞Ê¨Ñ‰Ωç]
    end

    %% ‰∏ªË¶ÅÊµÅÁ®ãÈÄ£Êé•
    DEP -->|‰æùË≥¥Ê™¢Êü•| A
    A -->|ÂÆåÊàê| B
    B -->|ÈÄÅÁøªË≠Ø| C
    C -->|ÂÆåÊàê| D

    classDef mainScript fill:#f96,stroke:#333,stroke-width:2px;
    classDef subProcess fill:#9cf,stroke:#333,stroke-width:1px;
    classDef utility fill:#fcf,stroke:#333,stroke-width:1px;
    classDef logger fill:#cfc,stroke:#333,stroke-width:1px;
    classDef tools fill:#ff9,stroke:#333,stroke-width:1px;
    
    class A,B,C,D mainScript;
    class A1,A11,A2,A21,A22,A3,A31,A32,B1,B2,B3,B4,B5,B6,C1,C2,C3,C4,C5,C6,C7,C8,D1,D2,D3 subProcess;
    class AA,AB,AC,AD,AE,AF,AG,AH,BA,BB,BC,BD,CA,CB,CC,CD,CE,CF,DA,DB,DC,DD utility;
    class ACL,BCL,CEL,DCL logger;
    class DEP,DEP1,DEP2,DEP3 utility;
    class T1,T2,T3,T11,T21,T31 tools;
