flowchart TB
    subgraph "1️⃣ 前置處理"
        A[stage1-preparation.applescript] -->|自動化處理| A1[從 Google Sheets 擷取資訊]
        A1 --> A2[下載 YouTube 影片]
        A2 --> A3[建立 WordPress 草稿]
        A -->|使用| AA[google_sheets.py]
        A -->|使用| AB[wordpress_api.py]
        A -->|使用| AC[logger.py]
        AC -->|統一日誌系統| ACL[log_bridge.py]
    end

    subgraph "2️⃣ 前製作業"
        B[stage2-processing.applescript] -->|人工決策| B1[決定單支/合併影片]
        B1 -->|自動化處理| B2[建立目錄結構]
        B2 --> B3[影片轉檔 1920*1340]
        B3 --> B4[使用 google_drive.py 上傳至 Google Drive]
        B4 -->|重試機制| B5[複製至桌面資料夾]
        B5 --> B6[建立 Trello 任務]
        B -->|使用| BA[google_sheets.py]
        B -->|使用| BB[face_center_crop.py]
        B -->|使用| BC[logger.py]
        B -->|使用| BD[google_drive.py]
        BC -->|統一日誌系統| BCL[log_bridge.py]
    end

    subgraph "3️⃣ 後製處理"
        C[stage3-subtitling.applescript] -->|字幕處理| C1[中英文加空白]
        C1 --> C2[轉換為 .ass 格式]
        C2 --> C3[合併影片字幕拆分]
        C3 --> C4[轉換為 .vtt 格式]
        C4 --> C5[上傳至 WordPress]
        C4 --> C6[硬燒字幕至影片]
        C6 --> C7[上傳至 Google Drive]
        C7 -->|模糊搜尋| C8[更新 Google Docs]
        
        C -->|使用| CA[add_spaces.py]
        C -->|使用| CB[srt_to_ass_with_style.py]
        C -->|使用| CC[subtitle_splitter.py]
        C -->|使用| CD[upload_vtt.py]
        C -->|使用| CE[logger.py]
        C -->|使用| CF[google_sheets.py]
        CE -->|統一日誌系統| CEL[log_bridge.py]
    end

    subgraph "4️⃣ IG 模板套用"
        D[stage4-ig.applescript] -->|讀取資料| D1[從 Google Docs 讀取文案]
        D1 --> D2[使用 FFmpeg 套用模板]
        D2 --> D3[輸出成品]
        D -->|使用| DA[ffmpeg_video_generator.py]
        D -->|使用| DB[ffmpeg_cover_generator.py]
        D -->|使用| DC[logger.py]
        DC -->|統一日誌系統| DCL[log_bridge.py]
    end

    %% 主要流程連接
    A -->|完成| B
    B -->|送翻譯| C
    C -->|完成| D

    classDef mainScript fill:#f96,stroke:#333,stroke-width:2px;
    classDef subProcess fill:#9cf,stroke:#333,stroke-width:1px;
    classDef utility fill:#fcf,stroke:#333,stroke-width:1px;
    classDef logger fill:#cfc,stroke:#333,stroke-width:1px;
    
    class A,B,C,D mainScript;
    class A1,A2,A3,B1,B2,B3,B4,B5,B6,C1,C2,C3,C4,C5,C6,C7,C8,D1,D2,D3 subProcess;
    class AA,AB,AC,BA,BB,BC,BD,CA,CB,CC,CD,CE,CF,DA,DB,DC utility;
    class ACL,BCL,CEL,DCL logger;
